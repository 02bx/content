<Group id="ldap">
<title>LDAP</title>
<description>LDAP is a popular directory service, that is, a
standardized way of looking up information from a central database.
It is relatively simple to configure a RHEL6 machine to obtain
authentication information from an LDAP server. If your network
uses LDAP for authentication, be sure to configure both clients and
servers securely.</description>


<Group id="openldap_client">
<title>Configure OpenLDAP Clients</title>
<description>This guide recommends configuring OpenLDAP clients by
manually editing the appropriate configuration files. RHEL6
provides an automated configuration tool called authconfig and a
graphical wrapper for authconfig called
<tt>system-config-authentication</tt>. However, these tools do not give
sufficient flexibility over configuration. The authconfig tools do
not allow you to specify locations of SSL certificate files, which
is useful when trying to use SSL cleanly across several protocols.
They are also overly aggressive in placing services such as
netgroups and automounter maps under LDAP control, where it is
safer to use LDAP only for services to which it is relevant in your
environment.</description>
<warning category="general">Before configuring any machine to be an
LDAP client, ensure that a working LDAP server is present on the
network. See Section 3.12.3 for instructions on configuring an LDAP
server.</warning>




<Rule id="ldap_client_tls_checkpeer">
<title>LDAP Uses TLS For All Transactions</title>
<description>
Ensure a copy of the site's CA certificate has been placed in
the file <tt>/etc/pki/tls/CA/cacert.pem</tt>.
Configure LDAP to enforce TLS use and to trust certificates
signed by the site's CA. First, edit the file <tt>/etc/pam_ldap.conf</tt>,
and add or correct the following lines:
<pre>
ssl start_tls
tls_checkpeer yes
tls_cacertdir /etc/pki/tls/CA
tls_cacertfile /etc/pki/tls/CA/cacert.pem
</pre>
Then edit <tt>/etc/openldap/ldap.conf</tt>, and add or correct the
following lines:
<br />
<pre>
TLS_CACERTDIR /etc/pki/tls/CA
TLS_CACERT /etc/pki/tls/CA/cacert.pem
</pre>
</description>
<ident cce="14894-0" />
<oval id="ldap_client_tls_checkpeer" />
</Rule>

</Group><!--End <Group id="openldap_client"> -->

<Group id="openldap_server">
<title>Configure OpenLDAP Server</title>
<description>This section contains guidance on how to configure an
OpenLDAP server to securely provide information for use in a
centralized authentication service. This is not a comprehensive
guide to maintaining an OpenLDAP server, but may be helpful in
securing an OpenLDAP infrastructure nonetheless.
</description>

<Rule id="package_openldap-servers_removed">
<title>Install OpenLDAP Server RPM</title>
<description>The <tt>openldap-servers</tt> package should be removed if not in use.  
Is this machine the OpenLDAP server? If not, remove the package:
<br />
<pre>
# yum erase openldap-servers
</pre>
The openldap-servers RPM is not installed by default on RHEL6
machines. It is needed only by the OpenLDAP server, not by the
clients which use LDAP for authentication.  If the system is not
intended for use as an LDAP Server it should be removed.
</description>
<ident cce="3501-4" />
<oval id="package_openldap-servers_removed" />
</Rule>

<Rule id="ldap_server_config_olcsuffix">
<title>Configure Domain-Specific Parameters</title>
<description>The <tt>ldap</tt> server should be configured to use a domain specific suffix.  
Is this system an OpenLDAP server? If so, 
edit the ldap configuration file at 
/etc/openldap/slapd.d/cn=config/olcDatabase={*}bdb.ldif 
to include suffix information relevant to your domain.
<br />
<pre>
Edit the ldap configuration file at 
/etc/openldap/slapd.d/cn=config/olcDatabase={*}bdb.ldif 
to include suffix information relevant to your domain.
olcSuffix: "dc=example,dc=com "
olcRootDN: "cn=Manager,dc=example,dc=com "
where dc=example,dc=com is the same root you will use on the LDAP clients.
</pre>
These are basic LDAP configuration directives. The suffix parameter gives the root name of all information
served by this LDAP server, and should be some name related to your domain. The rootdn parameter names
LDAP’s privileged user, who is allowed to read or write all data managed by this LDAP server.
</description>
<ident cce="3501-4" />
<oval id="ldap_server_config_olcsuffix" />
</Rule>

<Rule id="ldap_server_config_bdb_file_security">
<title>LDAP Configuration File Security</title>
<description>Is this system an OpenLDAP server? If so, 
ensure that the configuration files are protected from unauthorized
access or modification.
<br />
<pre>
Edit the ldap configuration file at 
/etc/openldap/slapd.d/cn=config/olcDatabase={*}bdb.ldif 

Ensure that the configuration file has reasonable permissions:
# chown root:ldap /etc/openldap/slapd.d/cn=config/olcDatabase={*}bdb.ldif
# chmod 640 /etc/openldap/slapd.d/cn=config/olcDatabase={*}bdb.ldif
</pre>
Protect configuration files containing the hashed password the same way you would protect other files, such as
/etc/shadow, which contain hashed authentication data.
</description>
<ident cce="CCE:TBD" />
<oval id="ldap_server_config_bdb_file_security" />
</Rule>

<Rule id="ldap_server_config_olcrootpw">
<title>Configure LDAP Root Password</title>
<description>Is this system an OpenLDAP server? If so, 
ensure that the RootDN uses a secure password 
<br />
<pre>
Generate a hashed password using the slappasswd utility:
# slappasswd
New password:
Re-enter new password:

This will output a hashed password string. 
Edit the file /etc/openldap/slapd.d/cn=config/olcDatabase={*}bdb.ldif, and add or correct
the line:
olcRootPW: {SSHA}hashed-password-string
</pre>
Be sure to select a secure password for the LDAP root user, since this user has permission to read and write all
LDAP data, so a compromise of the LDAP root password will probably enable a full compromise of your site.  
In addition, be sure to use a reasonably strong hash function.  The default hash function should be used.  The default hash function is a salted SHA-1 algorith which is FIPS 160-1 compliant.  Insecure schemes such as crypt should not be used.
</description>
<ident cce="TODO:CCE" />
<oval id="ldap_server_config_olcrootpw" />
</Rule>

<Rule id="ldap_server_config_certificate_files">
<title>Protect LDAP Certificate Files</title>
<description>Create the PKI directory for LDAP certificates if it does not already exist:
<pre>
# mkdir /etc/pki/tls/ldap
# chown root:root /etc/pki/tls/ldap
# chmod 755 /etc/pki/tls/ldap
</pre>
Using removable media or some other secure transmission format, install the files generated in the previous
step onto the LDAP server:
<pre>
/etc/pki/tls/ldap/serverkey.pem: the private key ldapserverkey.pem
/etc/pki/tls/ldap/servercert.pem: the certificate file ldapservercert.pem
</pre>
Verify the ownership and permissions of these files:
<pre>
# chown root:ldap /etc/pki/tls/ldap/serverkey.pem
# chown root:ldap /etc/pki/tls/ldap/servercert.pem
# chmod 640 /etc/pki/tls/ldap/serverkey.pem
# chmod 640 /etc/pki/tls/ldap/servercert.pem
</pre>
Verify that the CA’s public certificate file has been installed as /etc/pki/tls/CA/cacert.pem, and has the
correct permissions:
<pre>
# mkdir /etc/pki/tls/CA
# chown root:root /etc/pki/tls/CA/cacert.pem
# chmod 644 /etc/pki/tls/CA/cacert.pem
</pre>
As a result of these steps, the LDAP server will have access to its own private certificate and the key with which
that certificate is encrypted, and to the public certificate file belonging to the CA. Note that it would be possible
for the key to be protected further, so that processes running as ldap could not read it. If this were done, the
LDAP server process would need to be restarted manually whenever the server rebooted.
</description>
<ident cce="CCE-4360-4,CCE-4378-6,CCE-4492-5,CCE-4263-0,CCE-3502-2,CCE-4449-5,CCE-4361-2,CCE-4427-1,CCE-4321-6,CCE-4339-8,CCE-4105-3,CCE-3718-4" />
<oval id="ldap_server_config_certificate_files" />
</Rule>



</Group><!--End <Group id="openldap_server"> -->
</Group><!--End <Group id="ldap"> -->
