# platform = multi_platform_all
# reboot = false
# strategy = configure
# complexity = low
# disruption = high
- name: get back device associated to mountpoint
  shell: mount |grep ' MOUNTPOINT '|cut -d' ' -f 1
  register: device_name

- name: get back device previous mount flags
  shell: mount |grep ' MOUNTPOINT '| sed -re 's:.*\((.*)\):\1:'
  register: device_cur_mountflags

- name: get back device fstype
  shell: mount |grep ' MOUNTPOINT '| cut -d' ' -f 5
  register: device_fstype

- name: Ensure permission MOUNTFLAG is set on MOUNTPOINT
  mount:
    path: "MOUNTPOINT"
    src: "{{device_name}}"
    opts: "{{device_cur_mountflags}},MOUNTFLAG"
    state: "mounted"
    fstype: "{{device_fstype}}"

